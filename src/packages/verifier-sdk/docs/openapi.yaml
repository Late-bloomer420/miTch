openapi: 3.0.3
info:
  title: miTch Verifier API
  description: >
    Specification for a miTch-compliant Verifier Backend. 
    Enables secure, privacy-preserving credential verification with AAD-binding and cryptographic shredding guarantees.
  version: 1.0.0
  contact:
    name: miTch Core Team
    url: https://mitch-id.example.com

servers:
  - url: http://localhost:3001
    description: Local development server (Liquor Store Demo)

paths:
  /present:
    post:
      summary: Receive and verify a cryptographic presentation from a miTch Wallet.
      description: >
        The Wallet POSTs an encrypted transport package here. The Verifier SDK will 
        verify the AAD-binding, unwrap the session keys, and decrypt the proof.
      operationId: submitPresentation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransportPackage'
      responses:
        '200':
          description: Verification successful.
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  message:
                    type: string
        '400':
          description: Invalid package or integrity check failed.
        '403':
          description: Forbidden - Age requirement not met or proof invalid.

  /status:
    get:
      summary: Get current verification status (Polling endpoint).
      description: Used by the Verifier Frontend to update the UI once the Wallet has submitted a presentation.
      operationId: getStatus
      responses:
        '200':
          description: Current session status.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [WAITING, VERIFIED, FAILED]
                  verifierDid:
                    type: string

components:
  schemas:
    TransportPackage:
      type: object
      required:
        - ciphertext
        - aad_context
        - recipient
      properties:
        ciphertext:
          type: string
          description: Base64 encoded AES-GCM-256 ciphertext of the Proof Artifact.
        aad_context:
          $ref: '#/components/schemas/AADContext'
        recipient:
          type: object
          required:
            - encrypted_key
          properties:
            header:
              type: object
              properties:
                kid:
                  type: string
            encrypted_key:
              type: string
              description: The AES session key, wrapped with the Verifier's RSA public key (Base64).

    AADContext:
      type: object
      required:
        - decision_id
        - nonce
        - verifier_did
      properties:
        decision_id:
          type: string
          format: uuid
        nonce:
          type: string
          description: Anti-replay nonce provided by the verifier or generated by wallet.
        verifier_did:
          type: string
          description: The DID of the intended verifier (H6 Binding).

    VerifierRequest:
      type: object
      required:
        - verifierId
        - requestedClaims
      properties:
        verifierId:
          type: string
          description: The DID of the service requesting data.
        requestedClaims:
          type: array
          items:
            type: string
          description: List of raw PII claims requested.
        requestedProvenClaims:
          type: array
          items:
            type: string
          description: List of ZKP predicates/assertions requested (e.g. age >= 18).
        purpose:
          type: string
          description: Clear-text reason for the data request.
        origin:
          type: string
          format: uri

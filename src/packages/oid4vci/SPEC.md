# OID4VCI Issuer Service Specification

**ID:** T-82
**Principle:** Structural Non-Existence (Ephemeral Issuance)
**Generated By:** miTch Privacy Firewall Skill (Option C)

## 1. Purpose
To implement an OID4VCI (OpenID for Verifiable Credential Issuance) compliant issuer that allows the User Wallet to request and receive Verifiable Credentials without the Issuer retaining any persistent copy of the data.

## 2. Legal Framework & Privacy (GDPR-by-Construction)

| Field | Purpose | Legal Basis | Retention |
| :--- | :--- | :--- | :--- |
| **subject_did** | Binding the VC to the user | Art. 6(1)(b) Contract | Ephemeral (Session) |
| **claims** | Data to be attested | Art. 6(1)(b) Contract | Ephemeral (Session) |
| **issuance_date** | Validity period | Art. 6(1)(f) Legitimate Interest | Logged (Non-PII) |

### Structural Rules (Fail-Closed)
1.  **No DB for Claims**: The Issuer Service MUST NOT have a database table for User Attributes.
2.  **Encrypted Transit**: All flows must use TLS 1.3 + OID4VCI Encryption.
3.  **Crypto-Shredding**: Session keys used to sign/encrypt the response must be explicitly effectively deleted (GC'd) immediately after response.

## 3. Architecture

\`\`\`mermaid
sequenceDiagram
    participant W as Wallet (User Custody)
    participant I as Issuer (Ephemeral)
    
    W->>I: POST /credential-request (JWE Encrypted)
    Note over I: Decrypt JWE
    Note over I: Validate Policy (Fail-Closed)
    I->>I: Sign Credential (Ed25519)
    Note over I: DO NOT STORE CLAIMS
    I-->>W: Credential Response (JWE Encrypted)
    Note over I: Forget Session
\`\`\`

## 4. API Specification

### POST /credential-offer
*Initializes the flow.* 
- **Response**: `credential_issuer`, `credential_endpoint`, `batch_credential_endpoint`.

### POST /credential
*The core issuance endpoint.*
- **Input**: `CredentialRequest` (see types)
- **Output**: `CredentialResponse` containing the signed VC.
- **Privacy Check**: Input MUST be encrypted or signed proof of possession.

## 5. Privacy Audit Checklist
- [ ] `fail-closed`: Does the service reject requests with unknown schemas?
- [ ] `structural-non-existence`: Is there a database connected that *could* store claims? (Should be NO).
- [ ] `logging`: Are claims excluded from all logs?
